---
output: github_document
author: Luiza Piancastelli luiza.piancastelli@ucdconnect.ie
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

`rbcpingarch` is an R package providing code to simulate and fit the Bivariate Conditional Poisson INGARCH(1,1) process proposed in [Piancastelli, Barreto-Souza and Ombao](https://arxiv.org/abs/2011.08799). Our package links to `rstan`, so proper setup of C++ compiler is required for usage. Once this is done, installation from GitHub is as follows.

``` r
# install.packages("devtools")
devtools::install_github("luizapiancastelli/rbcpingarch")
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rbcpingarch)
library(ggplot2)
library(tidyr)
```

### BCP-INGARCH simulation

The next chunk of code exemplifies the usage of `rBCPINGARCH` for simulating a realisation of the bivariate conditional Poisson count process. A simplified description of the function arguments is included in the call of `help(rBCPINGARCH)`.

```{r}
A = diag(c(0.3, 0.1)) #Diagonal (2x2) matrix
B = diag(c(0.2, 0.3)) #Diagonal (2x2) matrix, can be non diagonal as long as stationarity conditions satisfied
omega = c(2,1) 
phi = 0.3 
n = 500  #Time series length

Y = rBCPINGARCH(A, B, omega, phi, n)
head(Y)
cor(Y)

Y_df = data.frame('y1' =Y[,1], 'y2' = Y[,2], 't' = 1:nrow(Y))
Y_df = pivot_longer(Y_df, cols = starts_with('y'), names_to = 'serie', values_to = 'count')

ggplot(Y_df, aes(x = t, y = count, color = serie))+
  geom_line()+theme_bw()+
  labs(y = 'Count', x = 'Time')

```

### Model fit

In what follows, the function `fit_BCP_INGARCH` is used for conditional maximum likelihood estimation of the model parameters for the bivariate count time series data of viral hepatites cases in the Brazilian cities Goiania and Brasilia. This data set is available in `rbcpingarch` via a call to `data("Y_hep")`, originally collected from the  [DATASUS platform](https://datasus.saude.gov.br). This function takes as arguments the observed data and specification of `A` and `B` matrices as diagonal or non-diagonal, which relates to the between series INGARCH parameters.

```{r}
data("Y_hep") #Loads the Brazilian hepatites count data set

fit_diag = fit_BCP_INGARCH(Y_hep, A.diag = TRUE, B.diag = TRUE) 
fit_diag$par #maximised parameter values
fit_diag$se  #asymptotic standard errors
fit_diag$loglik 

fit_nd = fit_BCP_INGARCH(Y_hep, A.diag = TRUE, B.diag = FALSE)
fit_nd$par
fit_nd$se
fit_nd$loglik
```

